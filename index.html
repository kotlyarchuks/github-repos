<!DOCTYPE html>
<html>
<head>
  <title>Github Repos</title>
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src='https://unpkg.com/babel-standalone@6/babel.min.js'></script>
  <style>
    .grid {

    }

    .grid__elem {
      display: inline-block;
      width: 300px;
      border: 0.5px solid lightgray;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id='app'></div>

  <script type='text/babel'>
    const LANGS = ["c++", "java", "javascript", "php", "python", "ruby"]

    window.API = {
      getRepos(lang){
        return fetch(`https://api.github.com/search/repositories?q=language:${lang}+sort:stars&order:desc`)
          .then(response => response.json())
          .then(json => {
            return json
          })
      }
    }
   const result = window.API.getRepos("php").then(resp => console.log(resp))
  

  function LangList(props){
    return (
      <ul>
        {props.langs.map(elem => (
          <li key={elem} onClick={() => props.changeLanguage(elem)}>
            {elem}
          </li>
        ))}
      </ul>
    )
  }

  function Grid(props){
    return (
      <div className="grid">
        {props.repos.map(elem => (
          <div className="grid__elem" key={elem.id}>
            <h4><a href={elem.html_url} target="blank">{elem.name}</a></h4>
          </div>
        ))}
      </div>
    )
  }

  class App extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        langs: props.langs, 
        repos: [],
        currentLang: ""
      }
      this.changeLanguage = this.changeLanguage.bind(this)
    }

    // componentDidMount() {
    //   API.getRepos(lang).then(resp => {
    //     this.setState({
    //       repos: resp.items
    //     })
    //   })
    // }

    changeLanguage(lang){
      API.getRepos(lang).then(resp => {
        this.setState({
          repos: resp.items
        })
      })
    }

    render() { 
      return (
        <div> 
          <LangList langs={this.state.langs} changeLanguage={this.changeLanguage}/>
          <Grid repos={this.state.repos}/>
        </div>
       );
    }
  }
   
  ReactDOM.render(
    <App langs={LANGS}/>,
    document.getElementById('app')
  )
 
  </script>
</body>
</html>