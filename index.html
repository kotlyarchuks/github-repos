<!DOCTYPE html>
<html>
<head>
  <title>Github Repos</title>
  <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src='https://unpkg.com/babel-standalone@6/babel.min.js'></script>
  <style>
    .grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .grid__elem {
      display: inline-block;
      width: 300px;
      border: 0.5px solid lightgray;
      text-align: center;
      padding: 10px;
    }

    .active {
      font-weight: bold
    }
  </style>
</head>
<body>
  <div id='app'></div>

  <script type='text/babel'>
    const LANGS = ["All", "c++", "java", "javascript", "php", "python", "ruby"]

    window.API = {
      getRepos(lang){
        return fetch(`https://api.github.com/search/repositories?q=language:${lang}+sort:stars&order:desc`)
          .then(response => response.json())
          .then(json => {
            return json
          })
      },
      shorten(str){
        return str && str.length > 110 ? str.slice(0, 110)+"..." : str
      }
    } 
  
 // LOADING component 
  class Loading extends React.Component {
    constructor(props) {
      super(props);
      this.state = { 
        text: "Loading"
       }
    }
    render() { 
      return ( 
        <div>{this.state.text}</div>
      );
    }
  }

  
// LANGLIST component
  function LangList(props){
    return (
      <ul>
        {props.langs.map(elem => {
          return (
            <li className={props.currentLang === elem ? "active" : ""} key={elem} onClick={() => props.changeLanguage(elem)}>
              {elem}
            </li>
          )
        })}
      </ul>
    )
  }

// GRID component
  function Grid(props){
    return (
      <div className="grid">
        {props.repos.map(elem => (
          <div className="grid__elem" key={elem.id}>
            <h4><a href={elem.html_url} target="blank">{elem.name}</a></h4>
            <p>{API.shorten(elem.description)}</p>
          </div>
        ))}
      </div>
    )
  }

// APP component
  class App extends React.Component {
    constructor(props) {
      super(props);
      this.state = {
        langs: props.langs, 
        repos: [],
        currentLang: "",
        defaultLang: props.defaultLang,
        loading: true
      }
      this.changeLanguage = this.changeLanguage.bind(this)
    }


    changeLanguage(lang){
      this.setState({
        loading: true
      })
      lang === "All" ? lang = "" : null 
      API.getRepos(lang).then(resp => {
        this.setState({
          repos: resp.items,
          currentLang: lang === "" ? "All" : lang,
          loading: false
        })
      })
    }

    componentDidMount() {
      this.changeLanguage(this.state.defaultLang)
    }

    render() {
      if(this.state.loading){
        return (
         <div> 
          <LangList langs={this.state.langs} changeLanguage={this.changeLanguage} currentLang={this.state.currentLang}/>
          <Loading />
         </div> 
        )
      } 
      return (
        <div> 
          <LangList langs={this.state.langs} changeLanguage={this.changeLanguage} currentLang={this.state.currentLang}/>
          <Grid repos={this.state.repos}/>
        </div>
       );
    }
  }

// RENDER
  ReactDOM.render(
    <App langs={LANGS} defaultLang="All"/>,
    document.getElementById('app')
  )
 
  </script>
</body>
</html>